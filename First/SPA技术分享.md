# SPA技术分享

## SPA的意义

- 向潜在攻击者隐藏服务端的端口
- 允许指定客户端访问指定服务的端口

## SPA技术介绍

## SPA原理

服务端发送一个UDP包给服务端，一般默认发送的60021端口，服务端收到该包后并进行验证，验证通过后操作打开指定端口(该端口只向客户端开放)

![spa-prot](SPA技术分享.assets/spa-prot.png)

- 如何进行密钥交换
- 如何进行身份认证
- 如何保证安全性
  - 防重放
  - 防篡改
  - 防中间人攻击

## SPA实现(以fwknop为例)

`fwknop`客户端发送给服务端的`UDP`包括如下信息:

- 16字节随机数据

- 客户端用户名

- 客户端时间戳

- `Fwknop`版本

- 模式(访问或命令)

- 访问(或命令字符串)

- MD5校验和

  ![11](SPA技术分享.assets/11.PNG)

- 发送的数据的生成（看源码）
- 收到数据的验证(看源码)
- 验证通过的行为（开放端口）(看源码)

## SPA的不足

- 发送的是单个的UDP包，如果包中途丢失怎么让客户端知道是丢失了
- 敲门的密钥是在客户端生成的并且保存，有没有更好的管理方式
- 当认证的客户端数量增大，怎么保证准确性？新加入用户需要人为将新用户的密钥保存进入服务端是否过于繁琐？
  - 采用数字证书验证，服务端保存CA证书，客户端使用被该CA证书签发的证书发送过来作为验证，验证通过后开通指定的端口



