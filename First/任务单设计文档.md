# 1. 总体设计

- 将界面上原来显示的平台修改为系统和架构，系统会对`linux`系统的类型进行细分并进行显示，架构会显示该`linux`架构
- 新增`linux`客户端上传，删除，推送的处理

# 2. 结构设计

# 3. 业务设计

- 读取上传的客户端文件名，根据文件名规则中匹配字符串，区分出系统类型`Uos/Kylin/NeoKylin/NFS`，之后再根据系统继续匹配字符串，区分出CPU架构包括`aarch64/amd64/mips64/loongarch64`等类型

- 上传客户端时会检测客户端文件名，包括后缀，能否匹配到指定的字符串，来确定该客户端文件名是否符合规范，不符合规范会出现错误提示，并停止客户端程序上传。

  客户端文件规范为：

  ```
  [.*]-[版本]-[.*]-[系统类型]-[.*].[架构].[deb/rpm]
  ```

  匹配客户端文件以`-`和`.`来分割文件名，以下是对需要匹配的版本，系统类型，架构进行细述

  - **版本规则:**

    版本序号格式为`x.x.x`，其中`x`为数字

  - **系统类型:**
    - `Uos `
    - `Kylin`
    - `NeoKylin`
    - `NFS`

  - **架构类型:**
    - `aarch64`
    - `amd64`
    - `mips64`
    - `loongarch64`

- 点击推送，会调用`client.xml`文件中`push`节点中的`linux`节点和对应的`xlst`生成`update.ini`文件，该文件根据`linux`的系统类型和架构不同保存在不同的文件夹内，`update.ini`文件内包含了`ip`，`port`，`version`和`url`等信息。

# 4. 部署和运行

# 5. 数据设计

获取的`update.ini`文件格式如下

```shell
# 服务信息
[ServerInfo]
# 门户服务监听的地址
ip = 0.0.0.0
# 门户服务监听的端口
port = 10009
# 门户服务的协议类型
protocol = http
# 推送的linux系统信息
[UpdateAll]
# 系统版本为空则该类型系统没有被推送
version = 
# 系统路径为空则该类型系统没有被推送
url = /linux/
# 客户端允许升级的IP段
[UpdataAllowIP]
AllowIP = 10.0.0.0/16,
```

如果该系统和架构类型下没有推送，那么其对应的`version`和`url`为空，如果该系统和架构类型推送后被删除，那么其对应的`version`和`url`会被清空

调用的`xml`文件是原来的`client.xml`文件与window上传客户端文件共用，没有修改

# 6. 接口设计

- 接口调用

  ```
  http://192.168.190.7:10009/linux/sys/cpu/update.ini
  ```

其中`sys`是系统类型，当前有`Uos`,`Kylin`,`NFS`,`NeoKylin`，`cpu`为CPU类型，当前支持`mips64`,`aarch64`,`amd64`,`loongarch64`等类型

# 7. 性能与可靠性

## 7.1 性能设计

## 7.2 可靠性设计

## 7.3 日志监控设计

# 8. 兼容性设计

# 9. 未解决的问题