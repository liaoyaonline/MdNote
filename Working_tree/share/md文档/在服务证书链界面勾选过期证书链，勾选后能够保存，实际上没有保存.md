# 在服务证书链界面勾选过期或者尚未生效证书链，勾选后能够保存，实际上没有保存

## 问题详情

调整系统时间，让某CA证书链尚未生效，在Web加速服务界面选择尚未生效的CA证书链

![image-20211202145052597](在服务证书链界面勾选过期证书链，勾选后能够保存，实际上没有保存.assets/image-20211202145052597.png)

点击保存后，被选中的尚未生效的证书链并没有保存

![image-20211202145240036](在服务证书链界面勾选过期证书链，勾选后能够保存，实际上没有保存.assets/image-20211202145240036.png)

## 问题追踪

追踪到代码`kssl/GAD/www/js/selectCert2.js`，对应的勾选函数`selectCert`，没有对证书链的有效情况进行判断

![image-20211202145519718](在服务证书链界面勾选过期证书链，勾选后能够保存，实际上没有保存.assets/image-20211202145519718.png)

## 问题解决

增加检测证书状态函数

![image-20211202145759927](在服务证书链界面勾选过期证书链，勾选后能够保存，实际上没有保存.assets/image-20211202145759927.png)

在勾选CA证书链之前先检测该证书状态是否合法，不合法则提示错误，取消勾选，退出函数

![image-20211202145955946](在服务证书链界面勾选过期证书链，勾选后能够保存，实际上没有保存.assets/image-20211202145955946.png)

## 测试验证

调整系统时间，让某CA证书状态变为尚未生效

![image-20211202134026950](在服务证书链界面勾选过期证书链，勾选后能够保存，实际上没有保存.assets/image-20211202134026950.png)

勾选证书链，提示报错

![image-20211202151605928](在服务证书链界面勾选过期证书链，勾选后能够保存，实际上没有保存.assets/image-20211202151605928.png)

同时勾选的证书链变为尚未勾选状态。

![image-20211202151705662](在服务证书链界面勾选过期证书链，勾选后能够保存，实际上没有保存.assets/image-20211202151705662.png)

设置系统时间，直至某证书链过期

![image-20211202152452590](在服务证书链界面勾选过期证书链，勾选后能够保存，实际上没有保存.assets/image-20211202152452590.png)

在WEB加速服务的证书链界面勾选该CA证书链，提示该证书链已经过期，并将勾选变为尚未勾选状态

![image-20211202152423846](在服务证书链界面勾选过期证书链，勾选后能够保存，实际上没有保存.assets/image-20211202152423846.png)

