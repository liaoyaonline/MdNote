

#### 1. 证书部分

#### 2. 服务部分

##### 2.1 HTTP代理服务

###### 2.1.1 功能测试

| 用例编号 | 测试子项目                 | 测试输入及操作描述                                           | 预期结果                                                     | 测试结果 |
| -------- | -------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | -------- |
| 21001    | IPv4、IPv6分离测试         | 新建两个服务，分别配置IPv4和IPv6的地址，并且两个服务监听相同的端口 | 服务配置成功，并且访问测试成功                               | 通过     |
| 21002    | 前端HTTP2协议测试          | 在服务基本配置中，开启“前端HTTP2协议”，在浏览器配置开启支持HTTP2协议，访问服务端口 | 访问成功，并且抓包中ServerHello的ALPN选择H2协议              | 通过     |
| 21003    | 客户端错误直接断开连接测试 | 服务客户端验证模式开启“强制验证”或者“强制验证-仅本地证书链”，使用错误的客户端证书连接网关，错误类型为：1. 证书未生效 2. 证书已过期 3. 证书被废除 4. 未提交证书 5. 提交错误证书 | 证书在SSL连接阶段直接断开SSL连接，                           | 通过     |
| 21004    | http自动重定向到https测试  | 在基本参数配置界面，点击开启该选项，分别配置“使用host”和”指定地址“，当配置指定地址是，配置一个外部的地址和端口 | 当配置host时，使用http访问服务，自动跳转到服务对应的https协议，当配置指定的地址和端口时，使用http访问跳转到指定的地址和端口 | 通过     |
| 21005    | 客户端信息校验测试         | 网关配置开启客户端信息检验功能                               | 当客户端SSL连接网关时，ClientHello的扩展中代SPA扩展则可以正常连接网关，当不带该扩展时，连接失败 | 通过     |
| 21006    | SSL Session Ticket测试     | 基本配置界面开启SSL Session选择客户端存储，上传一个48字节的随机比特文件 | 当不上传文件，对于单个服务，客户端连接网关后，网关会向客户端发送一个Ticket握手消息，后续客户端拿这个消息可以直接连接网关，不需要提交证书，当上传文件时，对于多个服务上传同于一个随机数文件的服务，客户端可以拿一个服务生成的ticket去访问第二个服务，并不需要提交证书 | 通过     |
|          |                            |                                                              |                                                              |          |



##### 2.2 TCP代理服务

##### 2.3 SKS服务

#### 3. 网络部分

| 用例编号 | 测试子项目          | 测试输入及操作描述                                           | 预期结果                                                     | 测试结果 |
| -------- | ------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | -------- |
| 31001    | 修改网络接口测试    | 在网络接口界面选择eth3[内网接口]，点击修改，在修改网络接口信息界对ipv6地址修改为`fc00::1234:5678:11` | 保存通过，在网络接口界面显示为修改后的ipv6地址               | 通过     |
| 31002    | 新增虚拟接口测试    | 在网络接口界面选择eth2[外网接口]选择添加虚拟接口，将ipv4地址填写为`192.168.192.11`，保存配置 | 保存成功，在界面eth2[外网接口]下出现新增的虚拟接口           | 通过     |
| 31003    | 新增路由            | 在路由配置界面点击添加按钮进入添加路由配置界面，将默认路由修改为网络路由，将接口配置为`eth2`，将目标网络设置为`180.101.49.0`，将目标掩码设置为24，将网关地址位置为`192.168.192.254`，保存后退出 | 导入成功，导出模块的配置还原到用例编号41002导出的配置        | 通过     |
| 31004    | 远程SSH访问控制测试 | 在远程维护界面启用远程WEB访问和远程SSH访问，将测试机IP包含在允许访问的地址列表中，将测试机IP不包含在允许访问的地址列表中，使用测试机SSH进行远程访问 | 当测试机IP包含在允许远程访问的地址列表中是，能够SSH，当测试机IP不包含在允许远程访问的地址列表中时不能够远程SSH | 通过     |
| 31005    | 增加管理员测试      | 在管理员配置界面点击添加，进入添加管理员界面，输入管理员名称和证书序列号，选择用户角色。使用该新增的管理员角色登录WEB管理界面 | 当用户在网关登录界面输入之前填写的管理员名称，能够正常进入网关管理界面，并根据其角色权限，显示不同的模块 | 通过     |
| 31006    | 日志转发测试        | 在日志转发界面设置好主日志服务器地址，主日志服务器端口，备用日志服务器地址，备用日志服务器端口，在后台使用tcpdump进行抓包，检查发送syslog | 能够看到发送的syslog和界面上的日志时一致的                   | 通过     |

#### 4. 系统部分

| 用例编号 | 测试子项目          | 测试输入及操作描述                                           | 预期结果                                                     | 测试结果 |
| -------- | ------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | -------- |
| 41001    | 配置本地时间        | 在请设置本地时间栏目选定本地时间，点击应用                   | 应用通过，系统时间与本地时间同步                             | 通过     |
| 41002    | 配置导出            | 在配置导出栏导出模块，将配置导出                             | 导出成功，得到配置压缩包                                     | 通过     |
| 41003    | 配置导入            | 在配置导入界面，输入用例编号41002设置的导出密码，填写导入配置原因，选择测试41003上导出的配置压缩包 | 导入成功，导出模块的配置还原到用例编号41002导出的配置        | 通过     |
| 41004    | 远程SSH访问控制测试 | 在远程维护界面启用远程WEB访问和远程SSH访问，将测试机IP包含在允许访问的地址列表中，将测试机IP不包含在允许访问的地址列表中，使用测试机SSH进行远程访问 | 当测试机IP包含在允许远程访问的地址列表中是，能够SSH，当测试机IP不包含在允许远程访问的地址列表中时不能够远程SSH | 通过     |
| 41005    | 增加管理员测试      | 在管理员配置界面点击添加，进入添加管理员界面，输入管理员名称和证书序列号，选择用户角色。使用该新增的管理员角色登录WEB管理界面 | 当用户在网关登录界面输入之前填写的管理员名称，能够正常进入网关管理界面，并根据其角色权限，显示不同的模块 | 通过     |
| 41006    | 日志转发测试        | 在日志转发界面设置好主日志服务器地址，主日志服务器端口，备用日志服务器地址，备用日志服务器端口，在后台使用tcpdump进行抓包，检查发送syslog | 能够看到发送的syslog和界面上的日志时一致的                   | 通过     |

#### 5. 其他测试

| 用例编号 | 测试子项目                                   | 测试输入及操作描述                                           | 预期结果                                                     | 测试结果 |
| -------- | -------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | -------- |
|          | 操作审计测试                                 | 进入系统管理->信息审计->操作审计界面，选择起始时间为2021-11-01终止时间为2021-11-17,点击搜索 | 正常显示过往操作内容                                         | 通过     |
|          | 系统内核显示测试                             | 重启虚拟机，进入内核选择界面                                 | 显示系统内核的选项                                           | 通过     |
|          | 生成站点证书请求页面超时保存测试             | 进入站点证书请求页面，填写时不点击保存，等待页面超时，点击生成请求 | 进入登录界面                                                 | 通过     |
|          | 生成站点证书请求时，ipv6地址不增加[]证书测试 | 进入站点证书请求页面，在输入站点名称栏目输入ipv6地址，不使用[],点击生成请求，在站点证书管理界面点击自签发证书 | 顺利生成证书                                                 | 通过     |
|          | http代理清除缓存测试                         | 建立一个http代理，开启缓存，打开链接，在状态监控界面显示当前缓存大小不为0，点击清除缓存 | 缓存清除成功，缓存大小显示为0                                | 通过     |
|          | HTTP访问日志开启定时写入                     | HTTP代理服务，开启访问日志定时写入，设置时间检查syslog发送情况 | 检测到syslog发送                                             |          |
|          | 缺少私钥的情况下导入站点证书测试             | 在后台删除站点证书的私钥，导入该站点证书                     | 导入成功                                                     | 通过     |
|          | MAS日志回滚测试                              | 在http反向代理处开启http测速功能，访问`https://10.0.80.141:12347/speed_get_test/1024`，后台查看`var/log/MAS/access.log`能够看到日志已经更新。不再进行其他操作，等待1小时后进行查看 | 日志重新变为空                                               |          |
|          | http代理运行日志界面测试                     | 新建代理服务，进入日志配置界面，查看日志默认配置             | 运行日志记录为到文件，运行日志等级为错误                     | 通过     |
|          | http服务代理中选择已过期CA证书链测试         | 在系统时间调整为某一个CA证书链过期之后，在http服务代理中选择该CA证书链 | 提示，该证书链已经过期，请重新选择                           | 通过     |
|          | TCP服务代理中选择已过期CA证书链测试          | 在系统时间调整为某一个CA证书链过期之后，在TCP服务代理中选择该CA证书链 | 提示，该证书链已经过期，请重新选择                           | 通过     |
|          | SKS服务代理中选择已过期CA证书链测试          | 在系统时间调整为某一个CA证书链过期之后，在SKS服务代理中选择该CA证书链 | 提示，该证书链已经过期，请重新选择                           | 通过     |
|          | 自负载TCP服务选项                            | 在自负载中选择TCP服务，查看配置界面                          | 因为TCP服务没有ipv6配置，所以自负载配置界面不应该显示ipv6    | 通过     |
|          | 服务界面过期启停测试                         | 新建服务，启动服务，在服务界面等待界面过期，点击停止服务以及新建服务，在服务界面等待界面过期，点击开启服务 | 跳转到登录界面                                               |          |
|          | 重名证书链显示测试                           | 签发两套证书链，其中一个根证书与另一个二级CA证书链重名，打开CA证书管理界面/http代理证书链界面/SKS证书链界面/，检查显示是否正确 | 显示正确，同名的二级CA证书在对应的根证书目录下，根证书在根证书目录下 | 通过     |
|          | 重名证书链勾选测试                           | 签发两套证书链，其中一个根证书与另一个二级CA证书链重名，打开CA证书管理界面/http代理证书链界面/SKS证书链界面/，勾选二级证书的时候，检查其同步选择的上级证书是否正确，取消根证书的时候，检查其同步取消的下级证书是否正确 | 选中二级CA证书的时候，同步选中的是其根证书而不是同名的二级CA证书，当取消根证书选择的时候，其同步取消的是其二级CA证书而不是其同名的根证书 | 通过     |
|          | 证书链验证深度提示测试                       | 打开http代理服务，进入安全选项界面，查看证书链验证深度旁边提示 | 提示为3-9(默认为4)                                           | 通过     |
|          | TCP代理证书链验证测试                        | 打开TCP代理，进入基本参数界面，在证书链验证深度选择为5，点击保存 | 正常保存                                                     | 通过     |
|          | MAS服务内存占用测试                          | 在http反向代理处开启http测速功能，访问`https://10.0.80.141:12347/speed_get_test/1024`，检查后台内存占用 | 在调用的时候有少量占用内存和CPU，调用结束后基本没占用内存和CPU | 通过     |
|          | 热备服务恢复测试                             | 新建热备服务，然后将热备配置导出，删除掉原来的热备服务，导入先前的热备配置 | 热备服务与之前一致                                           | 通过     |
|          | HTTP服务选项国密协议测试                     | 新建http代理服务，在基本参数界面的协议和算法安全级别选择国密协议，打开反向代理链接，进行抓包，查看SSL握手类型 | 在`Server_Hello`报文中能看到协议类型为`GMTLS`                | 通过     |
|          | 冗余热备IPV6显示测试                         | 在网络配置的网络接口中，将eth2配置为只有IPv4地址的接口，将eth3配置为既有IPV6又有IPV4地址的接口。先将热备服务选择为eth3，设置好虚拟ip地址。保存后，将eth3更换为eth2，切到热备管理界面，查看ipv6是否显示。 | 当选择的接口只有ipv4地址时，不显示ipv6地址                   | 通过     |
|          | 冗余热备IPV4显示测试                         | 在网络配置的网络接口中，将eth2配置为只有IPv6地址的接口，将eth3配置为既有IPV6又有IPV4地址的接口。先将热备服务选择为eth3，设置好虚拟ip地址。保存后，将eth3更换为eth2，切到热备管理界面，查看ipv4是否显示。 | 当选择的接口只有ipv6地址时，不显示ipv4地址                   | 通过     |
|          | SKS服务勾选缺少加密证书私钥测试              | 在证书管理界面导入一个双证书，在后台证书管理文件夹`/cfg/GAD/cert/site`将其加密证书的key手动删除，得到一个缺少加密证书私钥的双证书，在SKS服务的证书选择界面，选择这个证书，点击保存 | 提示该证书缺少私钥不能保存，点击返回返回证书选择界面         | 通过     |
|          | 加密卡密钥导出导入测试                       |                                                              |                                                              |          |

