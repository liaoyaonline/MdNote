# **在线相互发送数据的小程序-设计文档**



## 1 总体设计

- 1.1 客户端在面板输入信息后，按照功能对信息进行RC4加密封装
- 1.2 服务器接收客户端传入信息，对传入数据进行RC4解密，根据传输信息的类别做登录、退出，转送、广播等业务功能
- 1.3 服务端按照客户端传输信息需要，回传或转送RC4加密数据至当前客户端或指定客户端
- 1.4 客户端处理服务器回传数据，并实现相应业务功能



 ## 2 结构设计

* 程序业务功能分两部分组成：
  * 客户端：完成套接字的生成，面板数据的封装，服务端回传数据的处理
  * 服务端：接收客户端发送信息，处理信息对应的业务功能，



## 3 业务及数据设计

### 3.1 客户端登录服务器

- 客户端连接服务端

- 客户端第一次登录服务器时，需要向服务器发送登录请求，并处理服务端回传数据

  * 发送数据结构：

    ```json
    {"type":"login","msg":"dqf"}  // type为发送数据类型，msg为登录用户昵称
    ```

    回传数据结构：

    ````json
    {"type":"login","user_list":{"0":"dqf"},"userInfo"：{"username":"dqf","login_time":"2021-08-07 12:07"}} 
    // type为发送数据类型，msg为登录用户列表昵称，user_list为当前在线用户列表，userInfo为当前登录信息
    ````

   

### 3.2 客户端间通信

- 客户端处理登陆时服务端回传数据，获取当前用户列表，并显示

- 客户端向服务端发送信息，并指定信息发送的接收客户端昵称

  * 发送数据结构：

    ```json
    {"type":"user","msg":"hello","receiver_from":"jyj"}  // type为发送数据类型，msg为发送的信息，receiver_from为信息接收方昵称
    ```

    回传数据结构：

    ```json
    {"type":"user","msg":"send success"}  // type为发送数据类型，msg为信息成功发送回传信息
    ```

- 客户端接收服务端转送数据

  * 接收数据结构：

    ```json
    {"type":"talk","msg":"hello","send_from":"dqf"}  // type为发送数据类型，msg为发送的信息，send_from为信息发送方昵称
    ```

    发送回传数据结构：

    ```json
    {"type":"talk","msg":"receiver success"}  // type为发送数据类型，msg为信息成功发送回传信息
    ```

  

### 3.3 客户端退出服务器

* 客户端退出服务器时，向服务端发送退出请求

  * 发送数据结构：

    ```json
    {"type":"logout","msg":"bye"}  // type为发送数据类型，msg为发送的信息，receiver_from为信息接收方昵称
    ```

    回传数据结构：

    ```json
    {"type":"logout","msg":"logout success"}  // type为回传数据类型，msg为退出成功反馈，接收后自动断开连接
    ```

* 客户端退出服务器后，服务端向在线客户端广播

  - 发送数据结构：

    ```json
    {"type":"logout","msg":"bye","userInfo"：{"username":"dqf","logout_time":"2021-08-07 12:07"},"user_list":{"0":"jyj"}}  
    // type为发送数据类型，msg为发送的信息，userInfo为退出客户端信息，user_list为当前在线用户
    ```

​        

## 4 界面设计

​      待完成

## 4  部署和运行

  - 暂无


## 5 性能与可靠性

* 5.1 数据传输加解密采用RC4，key：‘123456’
* 5.2 日志监控
  * 服务端监听客户端登录、退出及通信数据

